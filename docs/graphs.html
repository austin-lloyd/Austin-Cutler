<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Austin Cutler - Data Viz</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Austin Cutler</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./graphs.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data Viz</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./classes.html" rel="" target="">
 <span class="menu-text">Workshops</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Viz</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<style>
  /* Hide the title element on the page */
  .title {
    display: none;
  }
</style>
<p>I spend far too much time thinking about data visualization. To make that time a little more productive for myself, I’ll use this part of the website to show off whatever graphs I’ve most recently made for the projects I’m working on, as well as the accompanying code.</p>
<section id="the-average-marginal-effect-of-in-party-candidate-extremism-by-district-partisan-advantage-2010-to-2022" class="level3">
<h3 class="anchored" data-anchor-id="the-average-marginal-effect-of-in-party-candidate-extremism-by-district-partisan-advantage-2010-to-2022">The Average Marginal Effect of In-party Candidate Extremism by District Partisan Advantage (2010 to 2022)</h3>
<p>The paper this figure is in can be found <a href="https://www.dropbox.com/scl/fi/4vlq73wrfprx04hboxlan/CHR__Political_Extremism_Penalty_.pdf?rlkey=gqp8x5i6wd8anktrkjn0m71dk&amp;dl=0">here</a>. The goal of this figure is to show how the average marginal effect of the ideological extremity of a respondent in the CES’s in-party candidate varies based on the level of district competition. The code below only includes the code for this figure specifically and not the remainder of the analysis. The tricky thing with this figure was getting the regions to be fully continuous, as PVI as an integer variable. Part of the code creates synthetic data at the points in between where the marginal effect is not significant and where it is to make the regions seamlessly change. I am not sure why <code>geom_ribbon()</code> does not just do this in the first place, but the approach I used worked just fine.</p>
<p><img src="full_in_pvi_marginal_ef.png" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclogit)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##reading in the data from before</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_rds</span>(<span class="st">'observational/cleaned data/ces_cleaned.rds'</span>) <span class="ot">-&gt;</span> ces_cand_ideo_val</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">'observational/data/extra_vars/pvi_all.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(seat, <span class="st">'house'</span>) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cd =</span> district) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">levels</span>(ces_cand_ideo_val<span class="sc">$</span>year)),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">cd   =</span> <span class="fu">str_replace</span>(cd, <span class="st">"(</span><span class="sc">\\</span><span class="st">D)(</span><span class="sc">\\</span><span class="st">d)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1-</span><span class="sc">\\</span><span class="st">2"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="ot">-&gt;</span> pvi</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">'lightgray'</span>,.<span class="dv">6</span>)),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">strip.text   =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'white'</span>, <span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#insert code for the analysis here#</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="do">##in-party</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">h_in_ext    =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(ces_cand_ideo_val<span class="sc">$</span>h_in_ext, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">to =</span> <span class="fu">max</span>(ces_cand_ideo_val<span class="sc">$</span>h_in_ext, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> .<span class="dv">01</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">pvi         =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(ces_cand_ideo_val<span class="sc">$</span>pvi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">to =</span> <span class="fu">max</span>(ces_cand_ideo_val<span class="sc">$</span>pvi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">h_out_ext   =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>h_out_ext, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">pid_str     =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>pid_str, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">ideo_str    =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>ideo_str, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">age         =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">age2        =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>age2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">educ2       =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>educ2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">race2       =</span> <span class="fu">median</span>(ces_cand_ideo_val<span class="sc">$</span>race2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender      =</span> <span class="fu">factor</span>(<span class="st">'Female'</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="fu">levels</span>(ces_cand_ideo_val<span class="sc">$</span>gender))),</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">cd          =</span> <span class="fu">as.factor</span>(<span class="fu">factor</span>(<span class="st">'AZ-02'</span>)),</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">year        =</span> <span class="fu">as.factor</span>(<span class="fu">median</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ces_cand_ideo_val<span class="sc">$</span>year))))) <span class="ot">-&gt;</span> test_i2</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>marginaleffects<span class="sc">::</span><span class="fu">slopes</span>(fit, <span class="at">newdata =</span> test_i2, <span class="at">variables =</span> <span class="st">'h_in_ext'</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">by =</span> <span class="st">'pvi'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">vote_choice =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vote_choice, pvi, estimate, conf.low,conf.high,predicted,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>         predicted_lo,predicted_hi,p.value) <span class="sc">%&gt;%</span> </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_choice =</span> <span class="fu">case_when</span>(vote_choice <span class="sc">==</span> <span class="st">'no_turnout'</span> <span class="sc">~</span> <span class="st">'Abstain'</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                                 vote_choice <span class="sc">==</span> <span class="st">'in_party'</span> <span class="sc">~</span> <span class="st">'Vote for In-party Candidate'</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                                 vote_choice <span class="sc">==</span> <span class="st">'out_party'</span> <span class="sc">~</span> <span class="st">'Vote for Out-party Candidate'</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                                 vote_choice <span class="sc">==</span> <span class="st">'other_cand'</span> <span class="sc">~</span> <span class="st">'Vote for Other Candidate'</span>),</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">vote_choice =</span> <span class="fu">factor</span>(vote_choice,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Abstain'</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Vote for In-party Candidate'</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Vote for Out-party Candidate'</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Vote for Other Candidate'</span>))) <span class="ot">-&gt;</span> margin_in_full</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="do">##graphing it</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>margin_in_full <span class="sc">%&gt;%</span> </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig   =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> .<span class="dv">05</span>, <span class="st">'Yes'</span>, <span class="st">'No'</span>),</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">consecutive_id</span>(sig)) <span class="ot">-&gt;</span> margin_in_full</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="do">###making extra observations to fill in gaps on figure</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>margin_in_full <span class="sc">%&gt;%</span> </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vote_choice,group) <span class="sc">%&gt;%</span> </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span><span class="sc">|</span><span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vote_choice) <span class="sc">%&gt;%</span> </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(pvi) <span class="sc">!=</span> <span class="dv">41</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group1 =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">2</span>)),<span class="at">each =</span> <span class="dv">2</span>)) <span class="ot">-&gt;</span> group_dat </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>group_dat <span class="sc">%&gt;%</span> </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1) <span class="sc">%&gt;%</span> </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">pvi =</span> <span class="fu">full_seq</span>(pvi,.<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(vote_choice,sig,group, <span class="at">.direction =</span> <span class="st">'downup'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(estimate,conf.low,conf.high),</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">seq</span>(<span class="fu">first</span>(.), <span class="fu">last</span>(.), <span class="at">length.out =</span> <span class="fu">n</span>()))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>pvi <span class="sc">%in%</span> <span class="fu">unique</span>(ces_cand_ideo_val<span class="sc">$</span>pvi)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>group1) <span class="sc">%&gt;%</span> </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vote_choice) <span class="sc">%&gt;%</span> </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(pvi, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="ot">-&gt;</span> fill_obs</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="co">#putting it all together for the figure</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>margin_in_full <span class="sc">%&gt;%</span> </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(fill_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pvi, <span class="at">y =</span> estimate,</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high))<span class="sc">+</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig, <span class="at">fill =</span> sig,<span class="at">group =</span> group), </span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig, <span class="at">group =</span> group),</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">data =</span> <span class="fu">filter</span>(margin_in_full, <span class="fu">abs</span>(pvi) <span class="sc">==</span> <span class="dv">13</span><span class="sc">|</span>pvi<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> .<span class="dv">75</span>)<span class="sc">+</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> <span class="fu">filter</span>(margin_in_full, <span class="fu">abs</span>(pvi) <span class="sc">==</span> <span class="dv">13</span><span class="sc">|</span>pvi<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)), <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(vote_choice), <span class="at">nrow =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Marginal Effect of In-party Candidate Extremity'</span>, </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">'District Competition'</span>,</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">'p &lt; 0.05'</span>, <span class="at">fill =</span> <span class="st">'p &lt; 0.05'</span>)<span class="sc">+</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Yes'</span> <span class="ot">=</span> <span class="st">'#ff664d'</span>, <span class="st">'No'</span> <span class="ot">=</span> <span class="st">'#33ffcc'</span>))<span class="sc">+</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Yes'</span> <span class="ot">=</span> <span class="st">'#ff664d'</span>, <span class="st">'No'</span> <span class="ot">=</span> <span class="st">'#33ffcc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-dashboard" class="level3">
<h3 class="anchored" data-anchor-id="data-dashboard">Data Dashboard</h3>
<p>Part of my work with the LeRoy Collins Institute has been to work on our election audit dashboard. For this, I created an interactive dashboard using <code>shiny</code> to display both the audit data and ballot images for several elections from Leon county. We’re currently working to expand the project to several other counties. The data dashboard for the 2024 general election in Leon county can be found below, but can be opened in full screen (which is a better experience in my opinion) by clicking <a href="https://lci-dashboards.duckdns.org/leon-gen-2024/">here</a>. The dashboards for other years can be found on <a href="https://www.voterdata.lci.fsu.edu/">our website</a>.</p>
<div>
  <iframe src="https://lci-dashboards.duckdns.org/leon-gen-2024/" width="1300" height="800" style="border: .5px solid black; margin-left: -225px;"></iframe>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries and read data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmlwidgets)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinydashboard)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>table_1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'table_1.csv'</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>table_1 <span class="sc">%&gt;%</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Difference_Choice Recorded</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Difference_Choice Recorded</span><span class="st">`</span><span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Difference_Ballots Counted</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Difference_Ballots Counted</span><span class="st">`</span><span class="sc">*-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Contest, Choice, <span class="st">`</span><span class="at">Dominion_Ballots Counted</span><span class="st">`</span>, <span class="st">`</span><span class="at">ClearBallot_Ballots Counted</span><span class="st">`</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Difference_Ballots Counted</span><span class="st">`</span>, <span class="st">`</span><span class="at">Dominion_Choice Recorded</span><span class="st">`</span>, <span class="st">`</span><span class="at">ClearBallot_Choice Recorded</span><span class="st">`</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Difference_Choice Recorded</span><span class="st">`</span>,<span class="st">`</span><span class="at">Overvoted WithVote for this Choice</span><span class="st">`</span>, </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Undervoted WithoutVote for this Choice</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'Ovals </span><span class="sc">\n</span><span class="st"> Counted </span><span class="sc">\n</span><span class="st"> Dominion'</span>    <span class="ot">=</span> <span class="st">`</span><span class="at">Dominion_Ballots Counted</span><span class="st">`</span>, </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Audit Ovals </span><span class="sc">\n</span><span class="st"> Counted </span><span class="sc">\n</span><span class="st"> ClearBallot'</span> <span class="ot">=</span> <span class="st">`</span><span class="at">ClearBallot_Ballots Counted</span><span class="st">`</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Difference in </span><span class="sc">\n</span><span class="st"> Ovals </span><span class="sc">\n</span><span class="st"> Counted'</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Difference_Ballots Counted</span><span class="st">`</span>, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Certified</span><span class="sc">\n</span><span class="st">Vote Count'</span>     <span class="ot">=</span> <span class="st">`</span><span class="at">Dominion_Choice Recorded</span><span class="st">`</span>, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>  <span class="ot">=</span> <span class="st">`</span><span class="at">ClearBallot_Choice Recorded</span><span class="st">`</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Difference</span><span class="sc">\n</span><span class="st">in Counts'</span>     <span class="ot">=</span> <span class="st">`</span><span class="at">Difference_Choice Recorded</span><span class="st">`</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>                            <span class="ot">=</span> <span class="st">`</span><span class="at">Overvoted WithVote for this Choice</span><span class="st">`</span>, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Under </span><span class="sc">\n</span><span class="st"> Vote'</span>                           <span class="ot">=</span><span class="st">`</span><span class="at">Undervoted WithoutVote for this Choice</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">'Ovals'</span>)) <span class="ot">-&gt;</span> table_1</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>table_2 <span class="ot">&lt;-</span> fst<span class="sc">::</span><span class="fu">read_fst</span>(<span class="st">'leon_2024g.fst'</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>table_2 <span class="sc">%&gt;%</span> </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'Ballot ID'</span>              <span class="ot">=</span> BallotID,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Choice'</span>                 <span class="ot">=</span> cand,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Vote Type'</span>              <span class="ot">=</span> vote_type,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Ballot Link'</span>            <span class="ot">=</span> view_ballot,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>         <span class="co">#'Oval Confidence Rank'   = oval_confidence_rank,</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Voting Method'</span>          <span class="ot">=</span> vote_mode,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Precinct'</span>               <span class="ot">=</span> PrecinctID) <span class="ot">-&gt;</span> table_2</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="fu">st_read</span>(<span class="st">'Shape files - combined precincts'</span>, <span class="at">layer =</span> <span class="st">'Leon_ShapeFile'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PRECINCT =</span> <span class="fu">str_replace_all</span>(PRECINCT, <span class="st">'/'</span>, <span class="st">' &amp; '</span>)) <span class="ot">-&gt;</span> map</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">st_transform</span>(map,<span class="at">crs =</span> <span class="dv">4326</span>) <span class="ot">-&gt;</span> map</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="st">'MAPBOX_TOKEN'</span> <span class="ot">=</span> <span class="st">'pk.eyJ1IjoiYXVzdGluLWN1dGxlciIsImEiOiJjbGt0enpwZG4wMW5iM3NsaDAxNjBoMm5nIn0.oBeanbdPK0aurRNUJG7jIg'</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>outline <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  htmlwidgets<span class="sc">::</span><span class="fu">onRender</span>(x,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"function(el, x) {</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="st">                          // Add hover event</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="st">                          el.on('plotly_hover', function(data) {</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="st">                            // Loop through each point hovered over</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="st">                            data.points.forEach(function(point) {</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="st">                              Plotly.restyle(el, {'marker.line.color': 'black', 'marker.line.width': 2}, [point.curveNumber]);</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="st">                            });</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="st">                          });</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="st">                          // Add unhover event to reset the color</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="st">                          el.on('plotly_unhover', function(data) {</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="st">                            data.points.forEach(function(point) {</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="st">                              Plotly.restyle(el, {'marker.line.color': 'rgba(0,0,0,0)', 'marker.line.width': 0}, [point.curveNumber]);</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="st">                            });</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="st">                          });</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="st">                        }</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="st">                        "</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">div</span>(<span class="at">id =</span> <span class="st">"map"</span>),</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">verbatimTextOutput</span>(<span class="st">"selected_precinct"</span>),</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">head</span>(</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">style</span>(<span class="fu">HTML</span>(</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.sidebar-toggle{position: absolute; left: 0;}'</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .logo {</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color:  white;</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="st">      }'</span>,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .logo:hover {</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .sidebar-menu&gt;li&gt;a{</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color:white;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="st">        border-bottom: 1px solid #000000;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="st">      }'</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .sidebar-menu&gt;li&gt;a:hover{</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color:white;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="st">        border-left: 3px solid #782F40;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="st">      }'</span>,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .navbar {</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="st">          margin-left: 0px !important;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-sidebar {</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-sidebar .sidebar .sidebar-menu .active a{</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color: white;</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .logo {</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color:  white;</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="st">        color: black;</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="st">      }'</span>,</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .logo:hover {</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .navbar {</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="st">          color: #000000;</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .navbar .sidebar-toggle {</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="st">          color: #000000;</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color: #dfedeb;</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="st">          border-bottom: 2px solid black;</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="st">          border-right: 2px solid black;}'</span>,</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-header .navbar .sidebar-toggle:hover {</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color: #782F40;}'</span>,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.skin-blue .main-sidebar {</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color:  white;</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="st">      '</span>,</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>      <span class="st">'skin-blue .main-sidebar .sidebar .sidebar-menu .active a{</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="st">          background-color: #782F40;</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="st">        }'</span>,</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.main-header .sidebar-toggle:before {</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="st">        content: "Filter Dashboard";</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="st">        font-family: calibri;</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 15px;</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="st">        font-weight: 900;</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="st">      }'</span>,</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="st">".content-wrapper { background-color: white; margin: 0}"</span>,</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.container-fluid {font-size: 12px; padding: 0}'</span>,</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>      <span class="st">".custom-select-wrapper {margin:1px; background-color: #dfedeb;}"</span>,</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      <span class="st">".custom-select {margin:1px; width: 100%; max-width: 350px; background-color: #dfedeb;}"</span>,</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>      <span class="st">".stripe tbody tr:nth-child(even) { background-color: #dfedeb; }"</span>,</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.shiny-input-container:not(.shiny-input-container-inline){max-height: 43px;color: #000000; background-color: white;}'</span>,</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.shiny-input-checkboxgroup {margin:1px; background-color: white; justify-content: center; color: #000000;}'</span>,</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.shiny-input-checkboxgroup.shiny-input-container-inline label~.shiny-options-group, .shiny-input-radiogroup.shiny-input-container-inline label~.shiny-options-group{margin-left: 1px}'</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.js-irs-0 {background: #dfedeb; }'</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.js-irs-0 .irs-bar-edge {background: #dfedeb; }'</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.box {margin:1px; border: 1px solid white; -webkit-box-shadow: none; -moz-box-shadow: none;box-shadow: none;}'</span>, </span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.box-header { background-color: #f9f9f9; }'</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.selectize-control { padding-left: 7px; padding-right: 7px; margin-bottom:100px;color: #000000;}'</span>,</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.shiny-input-radiogroup {margin: 1px; background-color: white; justify-content: center;color: #000000;}'</span>,</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>      <span class="st">".plotly { max-width: 100%;margin:1px }"</span>,</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>      <span class="st">".content-body {margin:1px; padding: 0; }"</span>,</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>      <span class="st">".dataTable-wrapper { margin: 1px;}"</span>,</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      <span class="st">".row { margin-bottom: 0; }"</span>,</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.col-special {margin-right:-15px}'</span>,</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.box-body {padding: 1px}'</span>,</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.total-table{margin:0; justify-content: center}'</span>,</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.link{color: #782F40; font-size: 25px; color: #782F40;font-weight: bold}'</span>,</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>      <span class="st">'.link:hover{color: #00524d}'</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">script</span>(</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>      <span class="st">"$(document).ready(function(){</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="st">    var mapPlots = document.getElementsByClassName('plotly');</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="st">    if (mapPlots.length &gt; 0) {</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="st">      for (var i = 0; i &lt; mapPlots.length; i++) {</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="st">        mapPlots[i].addEventListener('plotly_relayout', function(eventdata){</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="st">          Plotly.relayout(this, {autosize: true});</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="st">  });"</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dashboardPage</span>(</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dashboardHeader</span>(),</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dashboardSidebar</span>(<span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sidebarMenu</span>(<span class="fu">h2</span>(<span class="at">style =</span> <span class="st">'text-align: left; 24px; font-weight: bold; color:  #782F40;'</span>,</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">div</span>(<span class="fu">HTML</span>(<span class="st">'&lt;p&gt;Audit Filters&lt;/p&gt;'</span>))),</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">div</span>(<span class="at">style =</span> <span class="st">'padding-bottom: 20px'</span>,</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">selectInput</span>(<span class="st">"Contest"</span>, <span class="at">label =</span> <span class="st">"Contest"</span>,</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">selected =</span> <span class="st">'President and Vice President'</span>,</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">'All'</span>, <span class="fu">unique</span>(table_1<span class="sc">$</span>Contest))))),</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">selectInput</span>(<span class="st">"Candidate"</span>, <span class="at">label =</span> <span class="st">"Choice"</span>,</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(table_1<span class="sc">$</span>Choice)))),</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">h2</span>(<span class="at">style =</span> <span class="st">'text-align: left; 24px; font-weight: bold; color: #782F40;'</span>,</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">div</span>(<span class="fu">HTML</span>(<span class="st">'&lt;p&gt;Ballot Filters&lt;/p&gt;'</span>))),</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">radioButtons</span>(<span class="st">"OvalCat"</span>, <span class="at">label =</span> <span class="st">"Oval Confidence Rank"</span>,</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">'1-20'</span>), <span class="at">inline =</span> <span class="cn">TRUE</span>, <span class="at">selected =</span> <span class="st">'All'</span>)),</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">checkboxGroupInput</span>(<span class="st">"VotingMethod"</span>, <span class="at">label =</span> <span class="st">"Voting Method"</span>,</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">'Election Day Vote'</span>),</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">choices =</span> <span class="fu">c</span>(<span class="fu">unique</span>(table_2<span class="sc">$</span><span class="st">`</span><span class="at">Voting Method</span><span class="st">`</span>)),</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">inline =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">selectInput</span>(<span class="st">"Precinct"</span>, <span class="at">label =</span> <span class="st">"Precinct"</span>,</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(table_2<span class="sc">$</span>Precinct)))),</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">menuItem</span>(<span class="fu">checkboxGroupInput</span>(<span class="st">"VoteType"</span>, <span class="at">label =</span> <span class="st">"Vote Type"</span>, </span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">'Voted for Choice'</span>,</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>                                                                         <span class="st">'Voted for Other Choice'</span>,</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>                                                                         <span class="st">'Overvote'</span>, <span class="st">'Undervote'</span>),  </span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">'Voted for Choice'</span>),</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">inline =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dashboardBody</span>(</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">script</span>(</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>        <span class="fu">HTML</span>(</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$(document).on('shiny:connected', function(event) {</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a><span class="st">    $(document).on('click', function(evt) {</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a><span class="st">        // Get the sidebar element</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a><span class="st">        var el = document.getElementById('sidebarCollapsed');</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a><span class="st">        // Check if the click is outside the sidebar and if the sidebar is currently not collapsed</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a><span class="st">        if (!$(evt.target).closest('#sidebarCollapsed').length &amp;&amp; el.getAttribute('data-collapsed') !== 'true') {</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a><span class="st">            // Collapse the sidebar and set data-collapsed to true</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a><span class="st">            el.setAttribute('data-collapsed', 'true');</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a><span class="st">            $('body').addClass('sidebar-collapse'); // Collapse the sidebar using the class</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a><span class="st">    // Event to reopen the sidebar when the toggle button is clicked</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="st">    $('#sidebar-toggle').on('click', function() {</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a><span class="st">        var el = document.getElementById('sidebarCollapsed');</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="st">        // Toggle data-collapsed attribute between 'true' and 'false'</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="st">        if (el.getAttribute('data-collapsed') === 'true') {</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a><span class="st">            el.setAttribute('data-collapsed', 'false');</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a><span class="st">            $('body').removeClass('sidebar-collapse'); // Remove class to expand sidebar</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="st">            el.setAttribute('data-collapsed', 'true');</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a><span class="st">            $('body').addClass('sidebar-collapse'); // Add class to collapse sidebar</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a><span class="st">});</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a><span class="st">$(document).on('click', '#resetButton', function() {</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a><span class="st">      Shiny.setInputValue('reset_map_filter', Math.random());</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>        )),</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(<span class="fu">column</span>(<span class="at">width=</span><span class="dv">5</span>,</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>                <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">div</span>(<span class="fu">HTML</span>(<span class="st">'&lt;p&gt; &lt;a class = "link" </span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="st">         href="https://fsu.qualtrics.com/jfe/form/SV_dj1SffcmA9nC4dw"&gt;Click here to tell us about your experience!&lt;/a&gt;&lt;/p&gt;'</span>)))),</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>         <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>                <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">h3</span>(<span class="st">"Aggregate Audit Data"</span>, <span class="at">style =</span> <span class="st">"text-align: left; font-size: 24px; font-weight: bold; margin: 0;"</span>))</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">3</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">12</span>, </span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>         <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">4</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>             <span class="co">#h3("space", style = "text-align: left; font-size: 24px; font-weight: bold; margin: 0;color:white;"),</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>             <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"display: flex; justify-content: center;"</span>,</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"width: 100%; height: 100%;"</span>, </span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">plotlyOutput</span>(<span class="st">"diff_plot"</span>)</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>         <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">4</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>             <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"display: flex; justify-content: center;"</span>,</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"width: 100%; height: 100%;"</span>, </span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">plotlyOutput</span>(<span class="st">"ag_plot1"</span>)</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>         <span class="co">#box(width = 3, solidHeader = TRUE,</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>         <span class="co">#     div(style = "display: flex; justify-content: center;",</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>         <span class="co">#         div(style = "width: 100%; height: 100%;", </span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>         <span class="co">#             plotlyOutput("ag_plot2")</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>         <span class="co">#         )</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>         <span class="co">#     )</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>         <span class="co"># ),</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>         <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">4</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>             <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"display: flex; justify-content: center;"</span>,</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"width: 100%; height: 100%;"</span>, </span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">plotlyOutput</span>(<span class="st">"ag_plot3"</span>)</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>        <span class="fu">DTOutput</span>(<span class="st">"my_table"</span>)</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">10</span>),</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>,</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>           <span class="fu">downloadButton</span>(<span class="st">'aud_tab_download'</span>, <span class="st">'Download Audit Data'</span>))</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">8</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>        <span class="fu">DTOutput</span>(<span class="st">"my_table_2"</span>))</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>         <span class="fu">box</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>             <span class="fu">h3</span>(<span class="st">"Leon County Precincts"</span>, <span class="at">style =</span> <span class="st">"text-align: center; font-size: 24px; font-weight: bold; margin: 0;"</span>),</span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>             <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"display: flex; justify-content: center;"</span>,</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">div</span>(<span class="at">style =</span> <span class="st">"width: 100%; height: 100%;"</span>, </span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">leafletOutput</span>(<span class="st">"map_plot"</span>)</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Shiny app server</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>  filtered_table <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    filtered <span class="ot">&lt;-</span> table_1</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle Contest filter</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Contest)) {</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, Contest <span class="sc">==</span> input<span class="sc">$</span>Contest)</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Candidate <span class="sc">!=</span> <span class="st">'All'</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Candidate)){</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, Choice <span class="sc">==</span> input<span class="sc">$</span>Candidate)</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>    filtered </span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>  sketch <span class="ot">&lt;-</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">table</span>(</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tableHeader</span>(<span class="fu">names</span>(table_1)),</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tableFooter</span>(<span class="fu">rep</span>(<span class="st">""</span>, <span class="fu">ncol</span>(table_1)))</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>my_table <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(<span class="fu">filtered_table</span>(), <span class="at">filter =</span> <span class="st">'none'</span>, </span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>              <span class="at">escape =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollY =</span> <span class="dv">200</span>, <span class="at">dom =</span> <span class="st">'Bfrtip'</span>, <span class="at">lengthMenu =</span> <span class="fu">list</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>                             <span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>),</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>              <span class="at">selection =</span> <span class="st">'none'</span>,</span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>              <span class="at">class =</span> <span class="st">'cell-border stripe'</span>,</span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>              <span class="at">fillContainer =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>              <span class="at">container =</span> sketch</span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>aud_tab_download <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(<span class="at">filename =</span> <span class="st">'audit_data.csv'</span>,</span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">content =</span> <span class="cf">function</span>(con){</span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">write_csv</span>(<span class="fu">filtered_table</span>(), con)</span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>                                             })</span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>  filtered_choices <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>    choices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'All'</span>, <span class="fu">unique</span>(table_1<span class="sc">$</span>Choice))</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle Contest filter</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Contest)) {</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>      choices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'All'</span>, <span class="fu">unique</span>(table_1<span class="sc">$</span>Choice[table_1<span class="sc">$</span>Contest <span class="sc">==</span> input<span class="sc">$</span>Contest]))</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>    choices</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({<span class="fu">updateSelectInput</span>(session, <span class="at">inputId=</span><span class="st">"Candidate"</span>, </span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>                             <span class="at">choices =</span> <span class="fu">c</span>(<span class="fu">filtered_choices</span>()),</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>                             <span class="at">selected =</span> <span class="st">'All'</span>)})</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>ag_plot1 <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({ </span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>      <span class="co">#making the plot data</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a>      aggregated_data1 <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(Contest) <span class="sc">%&gt;%</span> </span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">'Difference'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span><span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Certified</span><span class="sc">\n</span><span class="at">Vote Count</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span>),</span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">'Count'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>,</span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Certified</span><span class="sc">\n</span><span class="st">Vote Count'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Certified</span><span class="sc">\n</span><span class="st">Vote Count'</span>,</span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>)))</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">==</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Contest)) {</span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>      aggregated_data1 <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">'Difference'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Certified</span><span class="sc">\n</span><span class="at">Vote Count</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span>),</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">'Count'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>,</span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Certified</span><span class="sc">\n</span><span class="st">Vote Count'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Certified</span><span class="sc">\n</span><span class="st">Vote Count'</span>,</span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>)))</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>    <span class="co">#making the plot</span></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>    gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aggregated_data1, </span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> Count, <span class="at">fill =</span> name,</span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>                     <span class="at">text =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">'Audit</span><span class="sc">\n</span><span class="st">Vote Count'</span>,</span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'Audit conducted using Clear Ballot Machines.'</span>, </span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'Votes counted using Dominion Machines.'</span>))) <span class="sc">+</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> Count<span class="sc">*</span><span class="fl">1.025</span>, </span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'&lt;b&gt;'</span>, scales<span class="sc">::</span><span class="fu">comma</span>(Count), <span class="st">'&lt;/b&gt;'</span>, <span class="at">sep =</span> <span class="st">''</span>)))<span class="sc">+</span></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">''</span>, <span class="at">y =</span> <span class="st">''</span>, <span class="at">title =</span> <span class="st">'Votes'</span>)<span class="sc">+</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>,</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>()) </span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>    <span class="co">#converting to plotly</span></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>    <span class="fu">outline</span>(<span class="fu">ggplotly</span>(gg,<span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'text'</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToAdd =</span> <span class="fu">c</span>(<span class="st">'toImage'</span>),</span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>             <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">'select'</span>,<span class="st">'hoverClosestCartesian'</span>,</span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'hoverCompareCartesian'</span>,<span class="st">'lasso2d'</span>),</span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>             <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>  <span class="co">#output$ag_plot2 &lt;- renderPlotly({ </span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  if (input$Contest != "All") {</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>  <span class="co">#making the plot data</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    aggregated_data2 &lt;- filtered_table() %&gt;% </span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      group_by(Contest) %&gt;% </span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      select(-contains('Difference')) %&gt;% </span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      summarize(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)),</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                `Under \n Vote` = `Under \n Vote`/n()) %&gt;% </span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      pivot_longer(cols = c(`Ovals \n Counted \n Dominion`:`Under \n Vote`),</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   values_to = 'Count') %&gt;% </span></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      filter(name %in% c('Audit Ovals \n Counted \n ClearBallot',</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         'Ovals \n Counted \n Dominion')) %&gt;% </span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      mutate(name = factor(name,</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                           levels = c('Ovals \n Counted \n Dominion',</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                      'Audit Ovals \n Counted \n ClearBallot')))</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  }</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  if (input$Contest == "All" &amp;&amp; !is.null(input$Contest)) {</span></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    aggregated_data2 &lt;- filtered_table() %&gt;% </span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      select(-contains('Difference')) %&gt;% </span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      summarize(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %&gt;% </span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      pivot_longer(cols = c(`Ovals \n Counted \n Dominion`:`Under \n Vote`),</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   values_to = 'Count') %&gt;% </span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      filter(name %in% c('Audit Ovals \n Counted \n ClearBallot',</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         'Ovals \n Counted \n Dominion')) %&gt;% </span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      mutate(name = factor(name,</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                           levels = c('Ovals \n Counted \n Dominion',</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                      'Audit Ovals \n Counted \n ClearBallot')))</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  }</span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>  <span class="co">#making the plot</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  gg &lt;- ggplot(aggregated_data2,</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               aes(x = name, y = Count, fill = name,</span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   text = paste(ifelse(name == 'Audit Ovals \n Counted \n ClearBallot',</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                       'Audit Ovals', 'Ovals'), 'Count:', scales::comma(Count)))) +</span></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    geom_bar(stat = 'identity', position = position_dodge(.95)) +</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    geom_text(aes(y = Count*1.025, </span></span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                  label = paste('&lt;b&gt;', scales::comma(Count), '&lt;/b&gt;', sep = '')))+</span></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    scale_y_continuous(labels = scales::comma)+</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    labs(x = '', y = '', title = 'Ovals')+</span></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    theme_minimal() +</span></span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    theme(legend.position = 'none',</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          plot.title = element_text(hjust = .5,</span></span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                    face = 'bold'),</span></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          strip.background = element_blank(),</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          strip.text.x = element_blank()) </span></span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>  <span class="co">#converting to plotly</span></span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  outline(ggplotly(gg,tooltip = c('text')))  %&gt;% </span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    config(displayModeBar = FALSE) %&gt;% </span></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    layout(xaxis = list(fixedrange = TRUE),</span></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           yaxis = list(fixedrange = TRUE))</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>  <span class="co">#})</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>ag_plot3 <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({ </span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>      <span class="co">#making the plot data</span></span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>      aggregated_data3 <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(Contest) <span class="sc">%&gt;%</span> </span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">'Difference'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span><span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Certified</span><span class="sc">\n</span><span class="at">Vote Count</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span>),</span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">'Count'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>, <span class="st">'Under </span><span class="sc">\n</span><span class="st"> Vote'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>, <span class="st">'Under </span><span class="sc">\n</span><span class="st"> Vote'</span>)))</span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">==</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Contest)) {</span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a>      aggregated_data3 <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">'Difference'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Certified</span><span class="sc">\n</span><span class="at">Vote Count</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Under </span><span class="sc">\n</span><span class="at"> Vote</span><span class="st">`</span>),</span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">'Count'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>, <span class="st">'Under </span><span class="sc">\n</span><span class="st"> Vote'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>, <span class="st">'Under </span><span class="sc">\n</span><span class="st"> Vote'</span>)))</span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a>    <span class="co">#making the plot</span></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>    gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aggregated_data3, </span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> Count, <span class="at">fill =</span> name,</span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>                     <span class="at">text =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>,</span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'An overvote is when a person casts votes for</span><span class="sc">\n</span><span class="st">more than one candidate in a given contest.'</span>,</span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'An undervote is when a voter does not cast a</span><span class="sc">\n</span><span class="st">vote for any candidate in a given contest.'</span>))) <span class="sc">+</span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(.<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">'Over </span><span class="sc">\n</span><span class="st"> Vote'</span>, Count<span class="sc">*</span><span class="fl">1.35</span>, Count<span class="sc">*</span><span class="fl">1.025</span>), </span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'&lt;b&gt;'</span>, scales<span class="sc">::</span><span class="fu">comma</span>(Count), <span class="st">'&lt;/b&gt;'</span>, <span class="at">sep =</span> <span class="st">''</span>)))<span class="sc">+</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">''</span>, <span class="at">y =</span> <span class="st">''</span>, <span class="at">title =</span> <span class="st">'Vote Type'</span>)<span class="sc">+</span></span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Accent'</span>)<span class="sc">+</span></span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>,</span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>()) </span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>    <span class="co">#converting to plotly</span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">outline</span>(<span class="fu">ggplotly</span>(gg,<span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'text'</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToAdd =</span> <span class="fu">c</span>(<span class="st">'toImage'</span>),</span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>             <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">'select'</span>,<span class="st">'hoverClosestCartesian'</span>,</span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'hoverCompareCartesian'</span>,<span class="st">'lasso2d'</span>),</span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>             <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diff_plot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({ </span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>      <span class="co">#making the plot data</span></span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a>      diff_dat <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span> <span class="ot">=</span> (<span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span>),</span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a>               <span class="at">Choice =</span> <span class="fu">str_replace_all</span>(Choice, <span class="st">' '</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(Contest,Choice,<span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span>,</span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">'Count'</span>)</span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">==</span> <span class="st">'All'</span>){</span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>      diff_dat <span class="ot">&lt;-</span> <span class="fu">filtered_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="at">Count =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(<span class="st">`</span><span class="at">Difference</span><span class="sc">\n</span><span class="at">in Counts</span><span class="st">`</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Choice =</span> <span class="st">'Total'</span>)</span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">'All'</span>){</span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>      lims <span class="ot">&lt;-</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">5</span>)</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>      nudge <span class="ot">&lt;-</span> .<span class="dv">15</span></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a>      diff_lab <span class="ot">&lt;-</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Choice'</span>, <span class="at">y =</span> <span class="st">'Count'</span>,</span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">'Difference in Votes Recorded'</span>)</span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a>      text <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(diff_dat<span class="sc">$</span>Count <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">paste</span>(<span class="fu">abs</span>(diff_dat<span class="sc">$</span>Count), </span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'more vote(s) were cast for this choice/candidate than counted on election day.'</span>,</span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sep =</span> <span class="st">' '</span>),</span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(diff_dat<span class="sc">$</span>Count <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'The vote count from election day and the audit were the same for this choice/candidate.'</span>,</span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">paste</span>(<span class="fu">abs</span>(diff_dat<span class="sc">$</span>Count), <span class="st">'less vote(s) were cast for this choice/candidate than counted on election day.'</span>,</span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sep =</span> <span class="st">' '</span>)))</span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="sc">$</span>Contest <span class="sc">==</span> <span class="st">'All'</span>){</span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>      lims <span class="ot">&lt;-</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>      nudge <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>      diff_lab <span class="ot">&lt;-</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">''</span>, <span class="at">y =</span> <span class="st">'Count'</span>,</span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">'Difference in Votes Recorded'</span>)</span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>      text <span class="ot">&lt;-</span> <span class="st">'The absolute total of differences found between the certified election and audit.'</span></span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a>    <span class="co">#making the plot</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>    gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diff_dat, <span class="fu">aes</span>(<span class="at">x =</span> Choice, <span class="at">y =</span> <span class="fu">abs</span>(Count), <span class="at">fill =</span> Choice,</span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>                                <span class="at">text =</span> text)) <span class="sc">+</span></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a>      lims<span class="sc">+</span></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>      diff_lab<span class="sc">+</span></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'&lt;b&gt;'</span>, <span class="fu">abs</span>(Count), <span class="st">'&lt;/b&gt;'</span>, <span class="at">sep =</span> <span class="st">''</span>)), <span class="at">nudge_y =</span> nudge)<span class="sc">+</span></span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Dark2'</span>)<span class="sc">+</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>,</span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>()) </span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>    <span class="co">#converting to plotly</span></span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>    <span class="fu">outline</span>(<span class="fu">ggplotly</span>(gg1,<span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'text'</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToAdd =</span> <span class="fu">c</span>(<span class="st">'toImage'</span>),</span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>             <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">'select'</span>,<span class="st">'hoverClosestCartesian'</span>,</span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'hoverCompareCartesian'</span>,<span class="st">'lasso2d'</span>),</span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>             <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>  filtered_table_2 <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>    filtered <span class="ot">&lt;-</span> table_2</span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>VotingMethod) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(input<span class="sc">$</span>VotingMethod) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, <span class="st">`</span><span class="at">Voting Method</span><span class="st">`</span> <span class="sc">%in%</span> input<span class="sc">$</span>VotingMethod)</span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(input<span class="sc">$</span>VotingMethod) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(input<span class="sc">$</span>VotingMethod) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> filtered[<span class="cn">NULL</span>,]</span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Contest <span class="sc">!=</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Contest)) {</span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, Contest <span class="sc">==</span> input<span class="sc">$</span>Contest)</span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>VoteType) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(input<span class="sc">$</span>VoteType) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, <span class="st">`</span><span class="at">Vote Type</span><span class="st">`</span> <span class="sc">%in%</span> input<span class="sc">$</span>VoteType)</span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(input<span class="sc">$</span>VoteType) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(input<span class="sc">$</span>VoteType) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> filtered[<span class="cn">NULL</span>,]</span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>OvalCat <span class="sc">!=</span> <span class="st">"All"</span> <span class="sc">&amp;&amp;</span> input<span class="sc">$</span>OvalCat <span class="sc">==</span> <span class="st">'1-20'</span>) {</span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered,  <span class="st">`</span><span class="at">Oval Confidence Rank</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Precinct <span class="sc">!=</span> <span class="st">'All'</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Precinct)){</span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, Precinct <span class="sc">==</span> input<span class="sc">$</span>Precinct)</span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Candidate <span class="sc">!=</span> <span class="st">'All'</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Candidate)){</span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>      filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(filtered, Choice <span class="sc">==</span> <span class="fu">word</span>(input<span class="sc">$</span>Candidate, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(filtered, <span class="sc">-</span>oval_cat)</span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>my_table_2 <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(<span class="fu">filtered_table_2</span>(), <span class="at">filter =</span> <span class="st">'none'</span>, </span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">rowsGroups =</span> <span class="fu">list</span>(<span class="dv">0</span>),</span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>                             <span class="at">scrollY =</span> <span class="dv">300</span>, <span class="at">dom =</span> <span class="st">'Bfrtip'</span>, <span class="at">lengthMenu =</span> <span class="fu">list</span>(<span class="dv">5000</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>                             <span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">serverSide =</span> <span class="cn">TRUE</span>, <span class="at">deferRender =</span> <span class="cn">TRUE</span>, <span class="at">virtualScroll =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>              <span class="at">selection =</span> <span class="st">'none'</span>,</span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>              <span class="at">class =</span> <span class="st">'cell-border stripe'</span>,</span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>              <span class="at">fillContainer =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>              <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>              <span class="at">callback =</span> <span class="fu">JS</span>(<span class="st">'table.page(1).draw(false);'</span>)</span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">formatStyle</span>(<span class="at">columns =</span> <span class="st">'Ballot Link'</span>,</span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>                      <span class="at">target =</span> <span class="st">'row'</span>, </span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>                      <span class="at">css =</span> <span class="fu">list</span>(<span class="st">"display:block; width:100%"</span>))</span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>  filtered_map_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>    my_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#D3D3D3"</span>, <span class="st">"#00524d"</span>)</span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>Precinct <span class="sc">!=</span> <span class="st">'All'</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>Precinct)){</span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>      selected_precinct <span class="ot">&lt;-</span> input<span class="sc">$</span>Precinct</span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>      map<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(map<span class="sc">$</span>PRECINCT <span class="sc">==</span> selected_precinct, <span class="st">"#00524d"</span>, <span class="st">"#D3D3D3"</span>)</span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>      <span class="fu">leaflet</span>(<span class="at">data =</span> map,</span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">leafletOptions</span>(</span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a>                <span class="at">dragging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>                <span class="at">minZoom =</span> <span class="dv">9</span>,</span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>                <span class="at">zoomControl =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a>                <span class="at">scrollWheelZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a>                <span class="at">doubleClickZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a>                <span class="at">boxZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a>                <span class="at">touchZoom =</span> <span class="cn">FALSE</span></span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a>              )) <span class="sc">%&gt;%</span></span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addProviderTiles</span>(<span class="st">'CartoDB.Voyager'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addPolygons</span>(</span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a>          <span class="at">fillColor =</span> <span class="sc">~</span>color,</span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a>          <span class="at">fillOpacity =</span> .<span class="dv">75</span>,</span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#000000"</span>,  <span class="co"># Border color</span></span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a>          <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a>          <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a>          <span class="at">layerId =</span> <span class="sc">~</span>PRECINCT,</span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="sc">~</span>PRECINCT,</span>
<span id="cb2-695"><a href="#cb2-695" aria-hidden="true" tabindex="-1"></a>          <span class="at">highlight =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb2-696"><a href="#cb2-696" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a>            <span class="at">fillColor =</span> <span class="st">'#00524d'</span>,</span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a>            <span class="at">fillOpacity =</span> <span class="fl">0.75</span>,</span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a>            <span class="at">bringToFront =</span> <span class="cn">TRUE</span></span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">84.353334</span>, <span class="at">lat =</span> <span class="fl">30.455000</span>, <span class="at">zoom =</span> <span class="fl">9.45</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a>        <span class="fu">onRender</span>(<span class="st">"</span></span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a><span class="st">  function(el, x) {</span></span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a><span class="st">    var map = this;</span></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a><span class="st">    // Compute bounds from polygons</span></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a><span class="st">    var bounds = L.latLngBounds([]);</span></span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a><span class="st">    map.eachLayer(function(layer) {</span></span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a><span class="st">      if (layer instanceof L.Polygon) {</span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a><span class="st">        try {</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a><span class="st">          bounds.extend(layer.getBounds());</span></span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a><span class="st">        } catch (e) {}</span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a><span class="st">    if (bounds.isValid()) {</span></span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a><span class="st">      map.fitBounds(bounds, {padding: [10, 10]});</span></span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a><span class="st">      // Delay zoom correction slightly so it happens after fitBounds</span></span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a><span class="st">      setTimeout(function() {</span></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a><span class="st">        var currentZoom = map.getZoom();</span></span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a><span class="st">        var minZoom = 9; // Set your minimum zoom level here</span></span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a><span class="st">        if (currentZoom &lt; minZoom) {</span></span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a><span class="st">          map.setZoom(minZoom);</span></span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a><span class="st">      }, 250);</span></span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a><span class="st">    // Add zoom control to top right</span></span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a><span class="st">    L.control.zoom({ position: 'topright' }).addTo(map);</span></span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addControl</span>(</span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a>          <span class="at">html =</span> <span class="st">"</span></span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;style&gt;</span></span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a><span class="st">      #resetButton {</span></span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a><span class="st">        padding: 6px;</span></span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 12px;</span></span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #f5f5f5;</span></span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a><span class="st">        border: 1px solid #ccc;</span></span>
<span id="cb2-744"><a href="#cb2-744" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 4px;</span></span>
<span id="cb2-745"><a href="#cb2-745" aria-hidden="true" tabindex="-1"></a><span class="st">        cursor: pointer;</span></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a><span class="st">        transition: background 0.3s;</span></span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a><span class="st">      #resetButton:hover {</span></span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #00524d;</span></span>
<span id="cb2-750"><a href="#cb2-750" aria-hidden="true" tabindex="-1"></a><span class="st">        color: #D3D3D3;</span></span>
<span id="cb2-751"><a href="#cb2-751" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-752"><a href="#cb2-752" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/style&gt;</span></span>
<span id="cb2-753"><a href="#cb2-753" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;button id='resetButton'&gt;All Precincts&lt;/button&gt;</span></span>
<span id="cb2-754"><a href="#cb2-754" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>,<span class="at">position =</span> <span class="st">"topleft"</span></span>
<span id="cb2-755"><a href="#cb2-755" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-756"><a href="#cb2-756" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-757"><a href="#cb2-757" aria-hidden="true" tabindex="-1"></a>      map<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="st">"#00524d"</span></span>
<span id="cb2-758"><a href="#cb2-758" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-759"><a href="#cb2-759" aria-hidden="true" tabindex="-1"></a>      <span class="fu">leaflet</span>(<span class="at">data =</span> map,</span>
<span id="cb2-760"><a href="#cb2-760" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">leafletOptions</span>(</span>
<span id="cb2-761"><a href="#cb2-761" aria-hidden="true" tabindex="-1"></a>                <span class="at">dragging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-762"><a href="#cb2-762" aria-hidden="true" tabindex="-1"></a>                <span class="at">minZoom =</span> <span class="dv">9</span>,</span>
<span id="cb2-763"><a href="#cb2-763" aria-hidden="true" tabindex="-1"></a>                <span class="at">zoomControl =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-764"><a href="#cb2-764" aria-hidden="true" tabindex="-1"></a>                <span class="at">scrollWheelZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-765"><a href="#cb2-765" aria-hidden="true" tabindex="-1"></a>                <span class="at">doubleClickZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-766"><a href="#cb2-766" aria-hidden="true" tabindex="-1"></a>                <span class="at">boxZoom =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-767"><a href="#cb2-767" aria-hidden="true" tabindex="-1"></a>                <span class="at">touchZoom =</span> <span class="cn">FALSE</span></span>
<span id="cb2-768"><a href="#cb2-768" aria-hidden="true" tabindex="-1"></a>              )) <span class="sc">%&gt;%</span></span>
<span id="cb2-769"><a href="#cb2-769" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addProviderTiles</span>(<span class="st">'CartoDB.Voyager'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-770"><a href="#cb2-770" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addPolygons</span>(</span>
<span id="cb2-771"><a href="#cb2-771" aria-hidden="true" tabindex="-1"></a>          <span class="at">fillColor =</span> <span class="sc">~</span>color,</span>
<span id="cb2-772"><a href="#cb2-772" aria-hidden="true" tabindex="-1"></a>          <span class="at">fillOpacity =</span> .<span class="dv">75</span>,</span>
<span id="cb2-773"><a href="#cb2-773" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#000000"</span>,  <span class="co"># Border color</span></span>
<span id="cb2-774"><a href="#cb2-774" aria-hidden="true" tabindex="-1"></a>          <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb2-775"><a href="#cb2-775" aria-hidden="true" tabindex="-1"></a>          <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb2-776"><a href="#cb2-776" aria-hidden="true" tabindex="-1"></a>          <span class="at">layerId =</span> <span class="sc">~</span>PRECINCT,</span>
<span id="cb2-777"><a href="#cb2-777" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="sc">~</span>PRECINCT,</span>
<span id="cb2-778"><a href="#cb2-778" aria-hidden="true" tabindex="-1"></a>          <span class="at">highlight =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb2-779"><a href="#cb2-779" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb2-780"><a href="#cb2-780" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb2-781"><a href="#cb2-781" aria-hidden="true" tabindex="-1"></a>            <span class="at">fillColor =</span> <span class="st">'#00524d'</span>,</span>
<span id="cb2-782"><a href="#cb2-782" aria-hidden="true" tabindex="-1"></a>            <span class="at">fillOpacity =</span> <span class="fl">0.75</span>,</span>
<span id="cb2-783"><a href="#cb2-783" aria-hidden="true" tabindex="-1"></a>            <span class="at">bringToFront =</span> <span class="cn">TRUE</span></span>
<span id="cb2-784"><a href="#cb2-784" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-785"><a href="#cb2-785" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb2-786"><a href="#cb2-786" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">84.353334</span>, <span class="at">lat =</span> <span class="fl">30.455000</span>, <span class="at">zoom =</span> <span class="fl">9.45</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-787"><a href="#cb2-787" aria-hidden="true" tabindex="-1"></a>        <span class="fu">onRender</span>(<span class="st">"</span></span>
<span id="cb2-788"><a href="#cb2-788" aria-hidden="true" tabindex="-1"></a><span class="st">  function(el, x) {</span></span>
<span id="cb2-789"><a href="#cb2-789" aria-hidden="true" tabindex="-1"></a><span class="st">    var map = this;</span></span>
<span id="cb2-790"><a href="#cb2-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-791"><a href="#cb2-791" aria-hidden="true" tabindex="-1"></a><span class="st">    // Compute bounds from polygons</span></span>
<span id="cb2-792"><a href="#cb2-792" aria-hidden="true" tabindex="-1"></a><span class="st">    var bounds = L.latLngBounds([]);</span></span>
<span id="cb2-793"><a href="#cb2-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-794"><a href="#cb2-794" aria-hidden="true" tabindex="-1"></a><span class="st">    map.eachLayer(function(layer) {</span></span>
<span id="cb2-795"><a href="#cb2-795" aria-hidden="true" tabindex="-1"></a><span class="st">      if (layer instanceof L.Polygon) {</span></span>
<span id="cb2-796"><a href="#cb2-796" aria-hidden="true" tabindex="-1"></a><span class="st">        try {</span></span>
<span id="cb2-797"><a href="#cb2-797" aria-hidden="true" tabindex="-1"></a><span class="st">          bounds.extend(layer.getBounds());</span></span>
<span id="cb2-798"><a href="#cb2-798" aria-hidden="true" tabindex="-1"></a><span class="st">        } catch (e) {}</span></span>
<span id="cb2-799"><a href="#cb2-799" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-800"><a href="#cb2-800" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a><span class="st">    if (bounds.isValid()) {</span></span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a><span class="st">      map.fitBounds(bounds, {padding: [10, 10]});</span></span>
<span id="cb2-804"><a href="#cb2-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-805"><a href="#cb2-805" aria-hidden="true" tabindex="-1"></a><span class="st">      // Delay zoom correction slightly so it happens after fitBounds</span></span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a><span class="st">      setTimeout(function() {</span></span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a><span class="st">        var currentZoom = map.getZoom();</span></span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a><span class="st">        var minZoom = 9; // Set your minimum zoom level here</span></span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a><span class="st">        if (currentZoom &lt; minZoom) {</span></span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a><span class="st">          map.setZoom(minZoom);</span></span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a><span class="st">      }, 250);</span></span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a><span class="st">    // Add zoom control to top right</span></span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a><span class="st">    L.control.zoom({ position: 'topright' }).addTo(map);</span></span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addControl</span>(</span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a>          <span class="at">html =</span> <span class="st">"</span></span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;style&gt;</span></span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a><span class="st">      #resetButton {</span></span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a><span class="st">        padding: 6px;</span></span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 12px;</span></span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #f5f5f5;</span></span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a><span class="st">        border: 1px solid #ccc;</span></span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 4px;</span></span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a><span class="st">        cursor: pointer;</span></span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a><span class="st">        transition: background 0.3s;</span></span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a><span class="st">      #resetButton:hover {</span></span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #00524d;</span></span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a><span class="st">        color: #D3D3D3;</span></span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/style&gt;</span></span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;button id='resetButton'&gt;All Precincts&lt;/button&gt;</span></span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>,<span class="at">position =</span> <span class="st">"topleft"</span></span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>map_plot <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filtered_map_plot</span>()</span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observe leaflet click event for precincts</span></span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>map_plot_shape_click, {</span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a>    event <span class="ot">&lt;-</span> input<span class="sc">$</span>map_plot_shape_click</span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(event<span class="sc">$</span>id)) {</span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If a precinct is clicked, update the input for precinct selection</span></span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a>      clicked_precinct <span class="ot">&lt;-</span> event<span class="sc">$</span>id</span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(session, <span class="st">"Precinct"</span>, <span class="at">selected =</span> clicked_precinct)</span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-857"><a href="#cb2-857" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-858"><a href="#cb2-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>reset_map_filter, {</span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session, <span class="st">"Precinct"</span>, <span class="at">selected =</span> <span class="st">'All'</span>)</span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Shiny app</span></span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="matching-to-improve-ron-desantis-voteshare-in-the-florida-elections-study-fes-and-the-ces" class="level3">
<h3 class="anchored" data-anchor-id="matching-to-improve-ron-desantis-voteshare-in-the-florida-elections-study-fes-and-the-ces">Matching to Improve Ron DeSantis voteshare in the Florida Elections Study (FES) and the CES</h3>
<p>This figure is from an earlier version of the survey weighting paper.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#loading in data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>fes_out <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/outcomes_all.csv'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>fes_leon_out <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/outcomes_leon_all.csv'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>fes_pid_reg <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/outcomes_all_pid_reg.csv'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>ces_out <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/outcomes_all_ces.csv'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#merging the data and making the changes to produce the graph</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>fes_out <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ces_out, fes_pid_reg, fes_leon_out) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cand <span class="sc">==</span> <span class="st">'DeSantis'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower_95 =</span> dv_val <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_95 =</span> dv_val <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_84 =</span> dv_val <span class="sc">-</span> <span class="fl">1.4051</span> <span class="sc">*</span> se,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_84 =</span> dv_val <span class="sc">+</span> <span class="fl">1.4051</span> <span class="sc">*</span> se,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">strata =</span> <span class="fu">str_replace_all</span>(strata, <span class="st">'Pid'</span>, <span class="st">'Party Reg.'</span>),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">strata =</span> <span class="fu">str_replace_all</span>(strata, <span class="st">'Age, Gender, Race'</span>, </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'Demographics'</span>),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">strata =</span> <span class="fu">factor</span>(strata,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'No Stratification'</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'County, Votemode, Gender, Race, Party Reg.'</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'County, Votemode, Demographics'</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'County, Votemode, Demographics, Party Reg.'</span>)),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'party'</span>, <span class="st">'Party'</span>),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'Party'</span>, <span class="st">'Party Reg.'</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'precinct'</span>, <span class="st">'Precinct'</span>),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'CMAGR'</span>, <span class="st">'County </span><span class="sc">\n</span><span class="st"> Votemode </span><span class="sc">\n</span><span class="st"> Demographics'</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'</span><span class="sc">\\</span><span class="st">+'</span>, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">scheme =</span> <span class="fu">str_replace_all</span>(scheme, <span class="st">'Votemode'</span>, <span class="st">'Vote Mode'</span>),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">survey =</span> <span class="fu">factor</span>(survey,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'CES'</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'FES'</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'FES w/Leon resample'</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'FES PID with Reg'</span>)),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">where</span>(is.numeric),<span class="sc">~</span>.<span class="sc">/</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(strata <span class="sc">==</span> <span class="st">'No Stratification'</span><span class="sc">|</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         strata <span class="sc">==</span> <span class="st">'County, Votemode, Demographics, Party Reg.'</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> scheme, <span class="at">y =</span> dv_val, <span class="at">color =</span> survey, <span class="at">shape =</span> survey))<span class="sc">+</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_84, <span class="at">ymax =</span> upper_84), </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">75</span>),</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_95, <span class="at">ymax =</span> upper_95), </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">75</span>),</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> .<span class="dv">75</span>)<span class="sc">+</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_nested_wrap</span>(<span class="fu">vars</span>(strata), <span class="at">ncol =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> .<span class="dv">594</span>), <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Dark2'</span>)<span class="sc">+</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">''</span>, <span class="at">shape =</span> <span class="st">''</span>, <span class="at">title =</span> <span class="st">'Stratification Variables'</span>,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">'Notes: Exact matching was done on county. </span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="st">       Demographics = Age,Gender, and Race'</span>,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">''</span>, <span class="at">y =</span> <span class="st">'DeSantis Voteshare'</span>)<span class="sc">+</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.415</span>, <span class="fl">0.635</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="fl">0.5</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>),</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span> </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">face =</span> <span class="st">'bold'</span>, <span class="at">color =</span> <span class="st">'gray54'</span>, <span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'gray54'</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'bottom'</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">'bold'</span>,<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">'bold'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="graphs_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>